## ‚úÖ Razorpay Integration Complete

I've implemented the Razorpay payment integration for your backend. Here's what was added:

### 1. **User Schema Updated** (Userschema.js)
- Added `razorpayDetails` object to store:
  - `customerId` - Razorpay customer ID
  - `subscriptionId` - Razorpay subscription ID
  - `planId` - Razorpay plan ID
  - `status` - Subscription status
  - `nextBillDate` - Next billing date
- Added `web_razorpay` to the `planSource` enum

### 2. **New Razorpay Routes** (razorpayPurchase.js)

**Endpoints created:**

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/razorpay/webhook` | POST | Receives Razorpay webhook events |
| `/api/razorpay/subscription-status` | GET | Returns user's Razorpay subscription status (requires auth) |
| `/api/razorpay/admin/manual-update` | POST | Admin endpoint to manually update user plans (super admin only) |

**Webhook Events Handled:**
- `subscription.charged` - Payment successful
- `subscription.activated` - Subscription activated
- `subscription.resumed` - Subscription resumed
- `subscription.cancelled` - Subscription cancelled
- `subscription.halted` - Subscription halted (payment failures)
- `subscription.pending` - Payment pending
- `subscription.paused` - Subscription paused

### 3. **Server Configuration** (server.js)
- Added raw body middleware for `/api/razorpay/webhook` endpoint
- Registered the new Razorpay routes

---

## üîß Environment Variable Required

Add this to your `.env` file:

```
RAZORPAY_WEBHOOK_SECRET=your_webhook_secret_from_razorpay_dashboard
```

---

## üìã How to Use (Creating Subscription Links)

When creating a subscription link in Razorpay Dashboard, add these **Notes**:

### For Enterprise Plans:
```
userId: "65f1a..." (MongoDB User ID - Required)
plan_type: "enterprise"
maxSites: "15"
maxEmployeesPerSite: "200"
isWhatsApp: "true"
isPDF: "true"
isExcel: "true"
isSupervisorAccess: "true"
isChangeTracking: "true"
```

### For Business Plans:
```
userId: "65f1a..." (MongoDB User ID - Required)
plan_type: "business"
maxSites: "10"
maxTotalEmployees: "500"
isWhatsApp: "true"
isPDF: "true"
isExcel: "true"
isSupervisorAccess: "true"
isChangeTracking: "true"
```

---

## üîê Security

- Webhook signature is validated using HMAC SHA256 with the `x-razorpay-signature` header
- All endpoints follow your existing authentication patterns
- Admin endpoint requires super admin authentication

Made changes.